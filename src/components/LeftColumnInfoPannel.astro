---
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faGlobe, faClock, faBookOpen, faBookmark, faTags } from '@fortawesome/free-solid-svg-icons';
import { formatDuration } from "../utils/utils.ts";
import { getRelativeLocaleUrl } from "astro:i18n";
import { getEntry } from 'astro:content';
import { getTranslationFunction } from '../utils/localization.ts';

// Get the translation function
const { lang } = Astro.params;
const t = getTranslationFunction(lang);

// Load the dictionaries that map codes to names (i.e ES -> Spain)
const GENRE_CODES_TO_NAME = (await getEntry('codes', 'genres')).data;
const country_codes_to_name = (await getEntry('codes', 'countries')).data;
const country_codes_to_flag = (await getEntry('codes', 'country-flags')).data;

const { posterUrl, duration, movieSaga, otherTitles } = Astro.props;
let { genres, productionCountries } = Astro.props;

// Map the genre codes to their names, and translate them
genres = genres.map(genre => ({
    name: t(GENRE_CODES_TO_NAME[genre]),
    url: getRelativeLocaleUrl(lang, `by-genre/${genre}`)
}));

// Append the flag emoji to the production countries
productionCountries = productionCountries.map(country => `${country_codes_to_flag[country]} ${country_codes_to_name[country]}`);

const iconClass = "w-3 h-3 text-indigo-300";
---

<aside>
    <img src={posterUrl} alt="Movie Poster" class="w-full h-auto object-cover rounded-lg"/>

    <div class="pt-2 pb-2">
        <ul class="space-y-2">
            <li class="relative py-2" aria-label={t("Genres")}>
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faBookOpen} class={iconClass} style={{ marginRight: '5px', maxHeight: "1.25rem"}} />{t("Genres")}
                </h4>
                <p class="text-xs">
                    {genres.map((genre, index) => (
                    <span key={genre.url}>
                        <a href={genre.url} class="text-indigo-400 hover:underline">{genre.name}</a>
                        {index < genres.length - 1 && ', '}
                    </span>
                ))}
                </p>
            </li>
            <li class="relative py-2" aria-label={t("Duration")}>
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faClock} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px', maxHeight: "1.1rem" }} />{t("Duration")}
                </h4>
                <p class="text-xs">{formatDuration(duration)}</p>
            </li>
            <li class="relative py-2" aria-label={t("Production Countries")}>
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faGlobe} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px', maxHeight: "1.1rem" }} />{t("Production Countries")}
                </h4>
                <p class="text-xs">{productionCountries.join(', ')}</p>
            </li>
            <li class="relative py-2" aria-label={t("Saga")}>
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faBookmark} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px', maxHeight: '1.1rem' }} />{t("Saga")}
                </h4>
                <p class="text-xs">{movieSaga}</p>
            </li>
            <li class="relative py-2" aria-label={t("Other Titles")}>
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faTags} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px', maxHeight: '1.1rem' }} />{t("Other Titles")}
                </h4>
                <p class="text-xs">{otherTitles}</p>
            </li>
        </ul>
    </div>
</div>

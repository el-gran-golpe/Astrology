---
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faGlobe, faClock, faBookOpen, faBookmark, faTags } from '@fortawesome/free-solid-svg-icons';
import { formatDuration } from "../utils/utils.ts";

import { getEntry } from 'astro:content';
import { getTranslationFunction } from '../utils/localization.ts';

// Get the translation function
const { lang } = Astro.params;
const t = getTranslationFunction(lang);

// Load the dictionaries that map codes to names (i.e ES -> Spain)
const genre_codes_to_name = (await getEntry('codes', 'genres')).data;
const country_codes_to_name = (await getEntry('codes', 'countries')).data;


const { posterUrl, duration, movieSaga, otherTitles } = Astro.props;
let { genres, productionCountries } = Astro.props;

// Map the genre codes to their names, and translate them
genres = genres.map(genre => genre_codes_to_name[genre]).map(genre => t(genre))

//TODO: Should we do the same for production countries? Maybe use flag emojis? Let it as codes?

---

<div>
    <img src={posterUrl} alt="Movie Poster" class="w-full h-auto object-cover rounded-lg"/>

    <div class="pt-2 pb-2">
        <ul class="space-y-2">
            <li class="relative py-2">
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faBookOpen} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px' }} />{t("Genres")}
                </h4>
                <p class="text-xs">{genres.join(', ')}</p>
            </li>
            <li class="relative py-2">
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faClock} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px' }} />Duration
                </h4>
                <p class="text-xs">{formatDuration(duration)}</p>
            </li>
            <li class="relative py-2">
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faGlobe} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px' }} />Production Countries
                </h4>
                <p class="text-xs">{productionCountries.join(', ')}</p>
            </li>
            <li class="relative py-2">
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faBookmark} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px' }} />Saga
                </h4>
                <p class="text-xs">{movieSaga}</p>
            </li>
            <li class="relative py-2">
                <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-gray-700 to-transparent"></div>
                <h4 class="text-lg font-semibold text-indigo-300 flex items-center">
                    <FontAwesomeIcon icon={faTags} class="w-3 h-3 text-indigo-300" style={{ marginRight: '5px' }} />Other Titles
                </h4>
                <p class="text-xs">{otherTitles}</p>
            </li>
        </ul>
    </div>
</div>

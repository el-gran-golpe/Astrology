---
import "../../layouts/global.css";

// Import the components
import Head from "../../components/Head.astro";
import Banner from "../../components/react/Banner.jsx";
import NavBar from "../../components/NavBar.astro";
import MovieCard from "../../components/MovieCard/MovieCard.astro";
import VisitedFilmsGrid from "../../components/react/VisitedFilmsGrid.jsx";
import Grid from '../../components/Grid.astro';

// Import your getHomePageFilmsByLang function
import { getHomePageFilms } from "../../utils/staticPathsGeneration.ts";
import { getTranslationFunction } from "../../utils/localization.ts";
import { getEntry } from "astro:content";

// Fetch the films
export async function getStaticPaths() {
    return await getHomePageFilms(10);
}

// Destructure the props
const { topLocationFilms, bannerFilms, topClassics, topRecent, topNominations, topHorror, topDocumentary } = Astro.props;
const { lang } = Astro.params;

// Get the translation function
const t = getTranslationFunction(lang);
const LANG_CODES_TO_NAMES = (await getEntry('location', 'languages-to-names')).data;
const config = (await getEntry("configs", "site-config")).data;

// Create an array of grid sections with title and subtitle
const gridSections = [
    {
        id: "top-recent-films",
        title: t("Watch Now"),
        subtitle: t("Must-See Movies from the Last Few Years"),
        films: topRecent,
        screenReaderText: t("This section features a collection of the most popular and talked-about films from the last few years. Top recent films to stream right now")
    },
    {
        id: "top-classics-films",
        title: t("Cinema Classics"),
        subtitle: t("Essential Timeless Masterpieces"),
        films: topClassics,
        screenReaderText: t("In this section you'll find a curated collection of the most important and celebrated films from the 1900s. Each movie is a critical piece of cinematic history, offering timeless entertainment.")
    },
    {
        id: "top-nominations-films",
        title: t("Awarded Masterpieces"),
        subtitle: t("Most Critically Acclaimed Films"),
        films: topNominations,
        screenReaderText: t("This section features a curated list of films that have garnered the highest number of awards. Each movie represents the pinnacle of cinematic excellence.")
    },
    {
        id: "top-horror-films",
        title: t("Horror Favorites"),
        subtitle: t("Movies Even Your Closet Monster Fears"),
        films: topHorror,
        screenReaderText: t("This section features a selection of top-rated horror films with terrifying scenes and jump scares. Perfect for horror fans seeking spine-chilling classics and modern hits.")
    },
    {
        id: "top-documentary-films",
        title: t("Essential Documentaries"),
        subtitle: t("Stories That Tell the Truth"),
        films: topDocumentary,
        screenReaderText: t("This section explores a selection of powerful and eye-opening documentaries. These works offer deep insights into real-world events and stories.")
    },
    {
        id: "top-location-films",
        title: t("%1 Cinema").replaceAll("%1", LANG_CODES_TO_NAMES[lang]),
        subtitle: t("Best Movies from %1-Speaking Countries").replace("%1", LANG_CODES_TO_NAMES[lang]),
        films: topLocationFilms,
        screenReaderText: t(`This section explores a selection of top-rated films produced in %1-speaking regions. These films showcase the cultural richness and storytelling traditions of their countries.`).replace("%1", LANG_CODES_TO_NAMES[lang])
    }
];

---
<html lang={lang}>
    <Head
        title={config["siteName"]}
        description={t("meta.description")}
        lang={lang}
        afterLangUrl={""}
        OGTitle={config["siteName"]}
        OGType={"website"}
        OGImage={config["OGImage.home"]}
        OGImageAlt={`${config["siteName"]} Banner`}
    />
    <body>
        <NavBar />
        <div class="bg-gray-900 text-white">
            <!-- Banner component with film data -->
            <header>
                <Banner client:only="react" films={bannerFilms} lang={Astro.params.lang} />
            </header>
            
            <!-- Main content -->
            <main class="container mx-auto px-6 py-4" role="main">
                {gridSections.map((section) => (
                    <section aria-labelledby={section.id} aria-describedby={`${section.id}-description`} class="mb-8">
                        <h2 id={section.id} class="flex items-center text-3xl font-bold mb-6">
                            <span class="text-white">{section.title}</span>
                            <span class="text-gray-400 font-light ml-2">{section.subtitle}</span>
                        </h2>
                        <p id={`${section.id}-description`} class="sr-only">
                            {section.screenReaderText}
                        </p>
                        <!-- Grid of movie cards -->
                        <Grid>
                            {section.films.map((film) => (
                                <MovieCard
                                    movieYear={film.basic_info.year}
                                    posterUrl={film.extended_info.poster_thumbnail_url}
                                    movieTitle={film.locationInfo.title}
                                    movieSlug={film.slug}
                                    movieDuration={film.basic_info.duration_minutes}
                                    moviePlot={film.locationInfo.short_synopsis}
                                    movieScore={film.film_affinity_info?.score?.average ?? 'Not available'} />
                            ))}
                        </Grid>
                    </section>
                ))}
                
                <!-- Grid of visited films -->
                <!-- TODO: Implement this after the release -->
                <!-- <section aria-labelledby="visited-films">
                    <h2 id="visited-films" class="flex items-center text-3xl font-bold text-white py-6">
                        {t("Visited films")}
                    </h2>
                    <div class='container'>
                        {<VisitedFilmsGrid currentLocale={Astro.currentLocale} client:only="react"/>}
                    </div>
                </section> -->
            </main>
        </div>
    </body>
</html>
